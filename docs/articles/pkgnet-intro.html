<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploring The Structure and Dependencies of An R Package • pkgnet</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Exploring The Structure and Dependencies of An R Package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pkgnet</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/uptakeopensource/pkgnet">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="pkgnet-intro_files/htmlwidgets-0.9/htmlwidgets.js"></script><link href="pkgnet-intro_files/vis-4.20.1/vis.css" rel="stylesheet">
<script src="pkgnet-intro_files/vis-4.20.1/vis.min.js"></script><script src="pkgnet-intro_files/visNetwork-binding-2.0.3/visNetwork.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Exploring The Structure and Dependencies of An R Package</h1>
            
      
      <small>Source: <a href="https://github.com/UptakeOpenSource/pkgnet/blob/master/vignettes/pkgnet-intro.Rmd"><code>vignettes/pkgnet-intro.Rmd</code></a></small>

    </div>

    
    
<!--  STYLE SET UP FOR TWO COLUMN SECTIONS  -->
<style>
.row:after {
    content: "";
    display: table;
    clear: both;
}
.column-left{
  float: left;
  width: 48%;
  text-align: justify;
  text-justify: inter-word;
  margin-right: 4%;
}
.column-right{
  float: right;
  width: 48%;
  text-align: justify;
  text-justify: inter-word;
}
</style>
<!--  CODE BELOW HERE WILL RENDER  --><p><code>pkgnet</code> is an R library designed for the analysis of R libraries! The goal of the package is to build a graph representation of a package and its dependencies to inform a variety of activities, including:</p>
<ul>
<li>prioritizing functions to unit test based on their centrality</li>
<li>examining the recursive dependencies you are taking on by using a given package</li>
<li>exploring the structure of a new package provided by a coworker or downloaded from the internet</li>
</ul>
<p>Below is a brief tour of <code>pkgnet</code> and its features.</p>
<hr>
<div id="dependencies-as-a-graph" class="section level1">
<h1 class="hasAnchor">
<a href="#dependencies-as-a-graph" class="anchor"></a>Dependencies As a Graph</h1>
<p><code>pkgnet</code> represents both package dependencies and function dependencies as directed graphs. Before we look at the output of <code>pkgnet</code>, here are few core concepts to keep in mind.</p>
<div class="figure" style="text-align: center">
<div id="htmlwidget-361f859342f565c90179" style="width:100%;height:465.984px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-361f859342f565c90179">{"x":{"nodes":{"id":[1,2,3,4],"label":["A","B","C","D"],"x":[1,3,2,4],"y":[1,1,2,3],"level":[1,1,2,3]},"edges":{"from":[1,2,3,2],"to":[3,3,4,4]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"circle","font":{"size":25,"bold":true,"align":"center"}},"manipulation":{"enabled":false},"edges":{"arrows":"to"},"layout":{"hierarchical":{"enabled":true,"direction":"DU"}},"interaction":{"dragNodes":true,"dragView":true,"zoomView":false}},"groups":null,"width":"100%","height":null,"idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p class="caption">
Example Dependency Graph
</p>
</div>
<div id="dependency" class="section level2">
<h2 class="hasAnchor">
<a href="#dependency" class="anchor"></a>Dependency</h2>
<p>Functions or Dependencies are represented as nodes, and their dependent relationships are represented as edges (a.k.a. arcs or arrows). The direction of the edge points towards the node that is dependent on the other node.</p>
<p>In the example dependency graph above:</p>
<ul>
<li>
<strong>C</strong> is dependent upon both <strong>A</strong> and <strong>C</strong>.</li>
<li>
<strong>D</strong> is dependent upon both <strong>C</strong> and <strong>B</strong>.</li>
<li>
<strong>D</strong> is indirectly dependent upon <strong>A</strong> through <strong>C</strong> via the transitive property.</li>
</ul>
</div>
<div id="descendants" class="section level2">
<h2 class="hasAnchor">
<a href="#descendants" class="anchor"></a>Descendants</h2>
<p>The descendants of a node are all subsequent nodes that depend on that node, either directly or via the transitive property.</p>
<p>In the example dependency graph above:</p>
<ul>
<li>
<strong>C</strong> and <strong>D</strong> are descendants of <strong>A</strong>.</li>
<li>
<strong>B</strong> is <strong>NOT</strong> a descendant of <strong>A</strong>.</li>
</ul>
<hr>
</div>
</div>
<div id="running-pkgnet" class="section level1">
<h1 class="hasAnchor">
<a href="#running-pkgnet" class="anchor"></a>Running pkgnet</h1>
<p><code>pkgnet</code> can analyze any R package locally installed. Run <code>installed.packages()</code> to see the full list of packages installed on your system. For this example, let’s say we are analyzing a custom built package, <code>baseballstats</code>.</p>
<p>To analyze <code>baseballstats</code>, run the following two lines of code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pkgnet)
report1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CreatePackageReport.html">CreatePackageReport</a></span>(<span class="dt">pkg_name =</span> <span class="st">"baseballstats"</span>)</code></pre></div>
<p>That’s it! You have generated a lot of valuable information with that one call for an installed package.</p>
<p>However, if the full source repository for the package is available on your system, you can supplement this report with other information such as code coverage from <a href="https://CRAN.R-project.org/package=covr">covr</a>. To do so, specify the path to the repository in <code>CreatePackageReport</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pkgnet)
report2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CreatePackageReport.html">CreatePackageReport</a></span>(
  <span class="dt">pkg_name =</span> <span class="st">"baseballstats"</span>
  , <span class="dt">pkg_path =</span> &lt;path to the repo&gt;
)</code></pre></div>
<hr>
</div>
<div id="examining-the-results" class="section level1">
<h1 class="hasAnchor">
<a href="#examining-the-results" class="anchor"></a>Examining The Results</h1>
<p>An HTML report has been created with the pertinent information and a list object is available with the same information and more.</p>
<div id="the-report" class="section level2">
<h2 class="hasAnchor">
<a href="#the-report" class="anchor"></a>The Report</h2>
<p>An HTML report has been created, and its location is specified in the messages in the terminal.</p>
<p>This report has three sections:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Package Summary</strong> – general information about the package and package level statistics<br>
</li>
<li>
<strong>Dependency Network</strong> – information regarding the packages upon which the current package under analysis relies upon<br>
</li>
<li>
<strong>Function Network</strong> – information regarding the functions within the current package under analysis and their inter dependencies</li>
</ol>
<p>Each section has helpful tables and visuals.</p>
<p>As a sample, here’s how the <strong>Function Network Visualization</strong> looks for <code>baseballstats</code>:</p>
<!--  SIDE BY SIDE START  -->
<div class="row">
<p><!--  Div to Wrap columns --></p>
<div class="column-left">
<h4 id="default">Default</h4>
<p></p>
<div id="htmlwidget-7520da194a39ad0eafff" style="width:288px;height:465.984px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-7520da194a39ad0eafff">{"x":{"nodes":{"node":["OPS","at_bats","batting_avg","on_base_pct","slugging_avg"],"outDegree":[0,2,1,1,0],"outBetweeness":[0,0,0.5,0.5,0],"outCloseness":[0.2,0.444444444444444,0.25,0.25,0.2],"numDescendants":[1,4,2,2,1],"hubScore":[0,1,1,1,0],"pageRank":[0.413720157147174,0.120882441825325,0.172257479601088,0.172257479601088,0.120882441825325],"inDegree":[2,0,1,1,0],"id":["OPS","at_bats","batting_avg","on_base_pct","slugging_avg"],"label":["OPS","at_bats","batting_avg","on_base_pct","slugging_avg"],"level":[0,2,1,2,1],"horizontal":[-1,-0.5,-1,0.5,0],"color":["#97C2FC","#97C2FC","#97C2FC","#97C2FC","#97C2FC"]},"edges":{"SOURCE":["at_bats","at_bats","batting_avg","slugging_avg"],"TARGET":["batting_avg","slugging_avg","OPS","OPS"],"from":["at_bats","at_bats","batting_avg","slugging_avg"],"to":["batting_avg","slugging_avg","OPS","OPS"],"color":["#848484","#848484","#848484","#848484"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"UD","sortMethod":"directed"}},"edges":{"arrows":"to"}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":5,"to":5},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null}},"evals":[],"jsHooks":[]}</script> All Functions and their dependencies are visible. For example, we can see that both <code>batting_avg</code> and <code>slugging_avg</code> functions depend upon the <code>at_bats</code> function.
<p>We also see that nothing depends on the <code>on_base_pct</code> function. This might be valuable information to an R package developer.</p>
</div>
<p><!--  End column-left --></p>
<div class="column-right">
<h4 id="with-coverage-information">With Coverage Information</h4>
<p></p>
<div id="htmlwidget-e20cc278557a44613714" style="width:288px;height:465.984px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-e20cc278557a44613714">{"x":{"nodes":{"node":["OPS","at_bats","batting_avg","on_base_pct","slugging_avg"],"coveredLines":[0,2,0,0,0],"totalLines":[3,2,4,6,5],"coverageRatio":[0,1,0,0,0],"meanCoveragePerLine":[0,1,0,0,0],"filename":["R/batting_statistics.R","R/batting_statistics.R","R/batting_statistics.R","R/batting_statistics.R","R/batting_statistics.R"],"outDegree":[2,1,1,0,0],"outBetweeness":[0,0.5,0.5,0,0],"outCloseness":[0.444444444444444,0.25,0.25,0.2,0.2],"numDescendants":[4,2,2,1,1],"hubScore":[1,1,1,0,0],"pageRank":[0.120882441825325,0.172257479601088,0.172257479601088,0.413720157147174,0.120882441825325],"inDegree":[0,1,1,2,0],"id":["OPS","at_bats","batting_avg","on_base_pct","slugging_avg"],"label":["OPS","at_bats","batting_avg","on_base_pct","slugging_avg"],"level":[0,2,1,2,1],"horizontal":[-1,-0.5,-1,0.5,0],"scaledColorValues":[0,1,0,0,0],"color":["#FF0000","#00FF00","#FF0000","#FF0000","#FF0000"]},"edges":{"SOURCE":["at_bats","at_bats","batting_avg","slugging_avg"],"TARGET":["batting_avg","slugging_avg","OPS","OPS"],"from":["at_bats","at_bats","batting_avg","slugging_avg"],"to":["batting_avg","slugging_avg","OPS","OPS"],"color":["#848484","#848484","#848484","#848484"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"layout":{"hierarchical":{"enabled":true,"direction":"UD","sortMethod":"directed"}},"edges":{"arrows":"to"}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":5,"to":5},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null}},"evals":[],"jsHooks":[]}</script> Same as the default visualization except we can see coverage information as well (Red = 0%, Green = 100%).
<p>It appears the function with the most dependencies, <code>at_bats</code>, is well covered. However, no other functions are covered by unit tests.</p>
</div>
<p><!--  End column-right  --></p>
</div>
<p><!--  End Div to Wrap columns --> <!--  SIDE BY SIDE END --></p>
<p><strong>Check out the full HTML report for more results</strong></p>
</div>
<div id="the-list-object" class="section level2">
<h2 class="hasAnchor">
<a href="#the-list-object" class="anchor"></a>The List Object</h2>
<p>The <code><a href="../reference/CreatePackageReport.html">CreatePackageReport()</a></code> function returns a list with three items:</p>
<ol style="list-style-type: decimal">
<li>SummaryReporter<br>
</li>
<li>DependencyReporter<br>
</li>
<li>FunctionReporter</li>
</ol>
<p>Each items contains information visible in the report <em>and more</em>. We can use this information for a more detailed analysis of the results and/or more easily incorporate <code>pkgnet</code> results into other R processes.</p>
<p>Here are a few notable items available within the list object.</p>
<div id="node-information" class="section level3">
<h3 class="hasAnchor">
<a href="#node-information" class="anchor"></a>Node Information</h3>
<p>Both the <code>DependencyReporter</code> and the <code>FunctionReporter</code> contain metrics about their package dependencies or functions (a.k.a network nodes) in a <code>nodes</code> table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(report2$FunctionReporter$nodes)</code></pre></div>
<pre><code>#&gt; [1]  5 13</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(report2$FunctionReporter$nodes)</code></pre></div>
<pre><code>#&gt;  [1] "node"                "coveredLines"        "totalLines"         
#&gt;  [4] "coverageRatio"       "meanCoveragePerLine" "filename"           
#&gt;  [7] "outDegree"           "outBetweeness"       "outCloseness"       
#&gt; [10] "numDescendants"      "hubScore"            "pageRank"           
#&gt; [13] "inDegree"</code></pre>
<p>Note, a few of these metrics provided by default are from the field of <a href="https://en.wikipedia.org/wiki/Network_theory">Network Theory</a>. You can leverage the <strong>Network Object</strong> described below to derive many more.</p>
</div>
<div id="network-measures" class="section level3">
<h3 class="hasAnchor">
<a href="#network-measures" class="anchor"></a>Network Measures</h3>
<p>Both the <code>DependencyReporter</code> and the <code>FunctionReporter</code> contain measures based on their network structure in a <code>network_measures</code> list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">report2$FunctionReporter$network_measures</code></pre></div>
<pre><code>#&gt; $centralization.OutDegree
#&gt; [1] 0.3
#&gt; 
#&gt; $centralization.betweenness
#&gt; [1] 0.03125
#&gt; 
#&gt; $centralization.closeness
#&gt; [1] 0.2743056</code></pre>
</div>
<div id="network-object" class="section level3">
<h3 class="hasAnchor">
<a href="#network-object" class="anchor"></a>Network Object</h3>
<p>Both the <code>DependencyReporter</code> and the <code>FunctionReporter</code> are available as <a href="http://igraph.org/r/">igraph</a> objects named <code>pkg_graph</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">report2$FunctionReporter$pkg_graph</code></pre></div>
<pre><code>#&gt; IGRAPH 2a618fb DN-- 5 4 -- 
#&gt; + attr: name (v/c)
#&gt; + edges from 2a618fb (vertex names):
#&gt; [1] at_bats     -&gt;batting_avg  at_bats     -&gt;slugging_avg
#&gt; [3] batting_avg -&gt;OPS          slugging_avg-&gt;OPS</code></pre>
<hr>
</div>
</div>
</div>
<div id="a-deeper-look" class="section level1">
<h1 class="hasAnchor">
<a href="#a-deeper-look" class="anchor"></a>A Deeper Look</h1>
<p>With the reports and objects produced by <code>pkgnet</code> by default, there is plenty to inform us on the inner workings of an R package. However, we may want to know MORE! Since the <a href="http://igraph.org/r/">igraph</a> objects are available, we can leverage those graphs for further analysis.</p>
<p>In this section, let’s examine a larger R package, such as <a href="http://lubridate.tidyverse.org/">lubridate</a>.</p>
<p>If you would like to follow along with the examples in this section, run these commands in your terminal to download and install <code>lubridate</code><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># Create a temporary workspace</span>
<span class="kw">mkdir</span> -p ~/pkgnet_example <span class="kw">&amp;&amp;</span> <span class="kw">cd</span> ~/pkgnet_example

<span class="co"># Grab the lubridate source code</span>
<span class="kw">git</span> clone https://github.com/tidyverse/lubridate
<span class="kw">cd</span> lubridate

<span class="co"># If you want the examples to match exactly</span>
<span class="kw">git</span> reset --hard 9797d69abe1574dd89310c834e52d358137669b8

<span class="co"># Install it</span>
<span class="kw">Rscript</span> -e <span class="st">"devtools::install()"</span></code></pre></div>
<div id="coverage-of-most-referenced-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#coverage-of-most-referenced-functions" class="anchor"></a>Coverage of Most Referenced Functions</h2>
<p>Let’s examine the relationship between a function’s total number of descendants and the unit test coverage of that function’s code.</p>
<!--  Faked Since lubridate not guaranteed to be installed at time of report creation -->
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Run pkgnet</span>
<span class="kw">library</span>(pkgnet)
report2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/CreatePackageReport.html">CreatePackageReport</a></span>(
    <span class="dt">pkg_name =</span> <span class="st">"lubridate"</span>
    , <span class="dt">pkg_path =</span> <span class="st">"~/pkgnet_example/lubridate"</span>
)

<span class="co"># Extract Nodes Table</span>
funcNodes &lt;-<span class="st"> </span>report2$FunctionReporter$nodes

<span class="co"># List Coverage For Most Referenced Functions</span>
mostRef &lt;-<span class="st"> </span>funcNodes[<span class="kw">order</span>(numDescendants, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)][<span class="dv">1</span>:<span class="dv">10</span>]
mostRef[,<span class="kw">list</span>(<span class="st">`</span><span class="dt">Function</span><span class="st">`</span> =<span class="st"> </span>node
              , <span class="st">`</span><span class="dt">Descendant Count</span><span class="st">`</span> =<span class="st"> </span>numDescendants
              , <span class="st">`</span><span class="dt">Coverage Ratio</span><span class="st">`</span> =<span class="st"> </span>coverageRatio
              , <span class="st">`</span><span class="dt">Total Lines</span><span class="st">`</span> =<span class="st"> </span>totalLines)]</code></pre></div>
<table class="table">
<colgroup>
<col width="34%">
<col width="25%">
<col width="22%">
<col width="18%">
</colgroup>
<thead><tr class="header">
<th align="left">Function</th>
<th align="right">Descendant Count</th>
<th align="right">Coverage Ratio</th>
<th align="right">Total Lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">divide_period_by_period</td>
<td align="right">39</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">days</td>
<td align="right">22</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">check_duration</td>
<td align="right">15</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">as.POSIXt</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">eweeks</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">check_interval</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">date&lt;-</td>
<td align="right">12</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">add_months</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">ceil_multi_unit</td>
<td align="right">10</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">am</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Inspecting results such as these can help an R package developer decide which function to cover with unit tests next.</p>
<p>In this case, <code>check_duration</code>, one of the most referenced functions (either directly or indirectly), is not covered by unit tests. However, it appears to be a simple one line function that may not be necessary to cover in unit testing. <code>check_interval</code>, on the other hand, might benefit from some unit test coverage as it is a larger, uncovered function with a similar number of dependencies.</p>
</div>
<div id="discovering-similar-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#discovering-similar-functions" class="anchor"></a>Discovering Similar Functions</h2>
<p>Looking at that same large package, let’s say we wanted to explore options for consolidating functions. One approach might be to explore consolidating functions that share the same dependencies. In that case, we could use the <code>igraph</code> object to highlight functions with the same dependencies via <a href="https://en.wikipedia.org/wiki/Jaccard_index">Jaccard similarity</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get igraph object</span>
funcGraph &lt;-<span class="st"> </span>report2$FunctionReporter$pkg_graph
funcNames &lt;-<span class="st"> </span>igraph::<span class="kw">vertex_attr</span>(funcGraph, <span class="dt">name =</span> <span class="st">"name"</span>)

<span class="co"># Jaccard Similarity</span>
sim &lt;-<span class="st"> </span>igraph::<span class="kw">similarity</span>(<span class="dt">graph =</span> funcGraph
                          , <span class="dt">mode =</span> <span class="st">"in"</span>
                          , <span class="dt">method =</span> <span class="st">"jaccard"</span>)
<span class="kw">diag</span>(sim) &lt;-<span class="st"> </span><span class="dv">0</span>
sim[sim &lt;<span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">0</span>

simGraph &lt;-<span class="st"> </span>igraph::<span class="kw">graph_from_adjacency_matrix</span>(<span class="dt">adjmatrix =</span> sim, <span class="dt">mode =</span> <span class="st">"undirected"</span>)

<span class="co"># Find groups with same dependencies (similarity == 1)</span>
sameDeps &lt;-<span class="st"> </span>igraph::<span class="kw">max_cliques</span>(<span class="dt">graph =</span> simGraph
                                , <span class="dt">min =</span> <span class="dv">2</span>
                                )

<span class="co"># Write results</span>
for (i in <span class="kw">seq_along</span>(sameDeps)) {
         <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">"Group "</span>, i, <span class="st">": "</span>))
         <span class="kw">cat</span>(<span class="kw">paste</span>(funcNames[<span class="kw">as.numeric</span>(sameDeps[[i]])], <span class="dt">collapse =</span> <span class="st">", "</span>))
         <span class="kw">cat</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)
}</code></pre></div>
<pre><code>#&gt; Group 1: stamp_time, stamp_date
#&gt; Group 2: ms, hm
#&gt; Group 3: new_interval, %--%, int_diff
#&gt; Group 4: floor_date, quarter, semester
#&gt; Group 5: picoseconds, microseconds, nanoseconds, milliseconds
#&gt; Group 6: weeks, days, years, seconds_to_period, seconds, new_period, minutes, hours
#&gt; Group 7: yq, dmy, ymd_hms, ymd_hm, ymd_h, ymd, ydm_hms, ydm_hm, ydm_h, ydm, pretty_dates, parse_date_time2, parse_date_time, myd, mdy_hms, mdy_hm, mdy_h, mdy, local_time, fast_strptime, dym, dmy_hms, dmy_hm, dmy_h</code></pre>
<p>Now, we have identified seven different groups of functions within <a href="http://lubridate.tidyverse.org/">lubridate</a> that share the <em>exact same</em> dependencies. We could explore each group of functions for potential consolidation.</p>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Examples from version 1.7.3 of Lubridate<a href="#fnref1">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#dependencies-as-a-graph">Dependencies As a Graph</a><ul class="nav nav-pills nav-stacked">
<li><a href="#dependency">Dependency</a></li>
      <li><a href="#descendants">Descendants</a></li>
      </ul>
</li>
      <li><a href="#running-pkgnet">Running pkgnet</a></li>
      <li>
<a href="#examining-the-results">Examining The Results</a><ul class="nav nav-pills nav-stacked">
<li><a href="#the-report">The Report</a></li>
      <li><a href="#the-list-object">The List Object</a></li>
      </ul>
</li>
      <li>
<a href="#a-deeper-look">A Deeper Look</a><ul class="nav nav-pills nav-stacked">
<li><a href="#coverage-of-most-referenced-functions">Coverage of Most Referenced Functions</a></li>
      <li><a href="#discovering-similar-functions">Discovering Similar Functions</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Brian Burns, James Lamb.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
